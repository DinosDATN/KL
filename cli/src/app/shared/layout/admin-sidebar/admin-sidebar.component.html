<aside
  class="bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 fixed left-0 top-16 h-[calc(100vh-4rem)] z-40 overflow-y-auto shadow-sm lg:translate-x-0"
  [class.w-64]="!isCollapsed"
  [class.w-16]="isCollapsed && !isMobile()"
  [class.translate-x-0]="!isCollapsed"
  [class.-translate-x-full]="isCollapsed"
>
  <nav [class]="isCollapsed ? 'p-2 space-y-1' : 'p-4 space-y-2'">
    <div
      *ngFor="let item of menuItems; let i = index"
      class="sidebar-item group/item"
    >
      <!-- Main menu item -->
      <div
        (click)="toggleSubmenu(item)"
        [class]="
          isCollapsed
            ? 'flex items-center justify-center p-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer transition-all duration-200'
            : 'flex items-center justify-between p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer transition-colors'
        "
        [class.bg-blue-50]="
          !isCollapsed && !item.children && isActive(item.route)
        "
        [class.dark:bg-blue-900]="
          !isCollapsed && !item.children && isActive(item.route)
        "
        [class.text-blue-600]="
          !isCollapsed && !item.children && isActive(item.route)
        "
        [class.dark:text-blue-400]="
          !isCollapsed && !item.children && isActive(item.route)
        "
        [class.bg-gray-50]="
          !isCollapsed && item.children && hasActiveChild(item)
        "
        [class.dark:bg-gray-700]="
          !isCollapsed && item.children && hasActiveChild(item)
        "
        [class.active-collapsed]="
          isCollapsed && (isActive(item.route) || hasActiveChild(item))
        "
        [title]="isCollapsed ? item.label : ''"
      >
        <div
          [class]="
            isCollapsed
              ? 'flex items-center justify-center w-full'
              : 'flex items-center space-x-3 min-w-0 flex-1'
          "
        >
          <svg
            [class]="
              isCollapsed
                ? 'w-6 h-6 flex-shrink-0 transition-all duration-200'
                : 'w-5 h-5 flex-shrink-0 transition-colors'
            "
            [class.text-blue-600]="!item.children && isActive(item.route)"
            [class.dark:text-blue-400]="!item.children && isActive(item.route)"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              [attr.d]="item.icon"
            ></path>
          </svg>
          <span
            *ngIf="!isCollapsed"
            class="font-medium text-sm truncate transition-colors"
            >{{ item.label }}</span
          >
        </div>

        <!-- Chevron icon for items with children -->
        <div
          *ngIf="item.children && !isCollapsed"
          class="flex-shrink-0 ml-auto"
        >
          <svg
            class="w-4 h-4 transition-transform duration-200"
            [class.rotate-180]="item.isExpanded"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>

        <!-- Badge if present (only show when not collapsed) -->
        <span
          *ngIf="item.badge && !isCollapsed"
          class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full badge ml-auto"
          >{{ item.badge }}</span
        >
      </div>

      <!-- Submenu items -->
      <div
        *ngIf="item.children && item.isExpanded && (!isCollapsed || isMobile())"
        class="ml-4 sm:ml-8 mt-2 space-y-1 submenu-enter"
      >
        <a
          *ngFor="let child of item.children"
          [routerLink]="child.route"
          class="flex items-center space-x-3 p-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-200 group"
          [class.active-child]="isActive(child.route)"
          [title]="child.label"
        >
          <svg
            class="w-4 h-4 flex-shrink-0 transition-colors"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              [attr.d]="child.icon"
            ></path>
          </svg>

          <span class="font-medium truncate">{{ child.label }}</span>

          <!-- Badge for child items if present -->
          <span
            *ngIf="child.badge"
            class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full badge ml-auto"
            >{{ child.badge }}</span
          >
        </a>
      </div>
    </div>
  </nav>
</aside>
