<aside
  class="bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 fixed left-0 top-16 h-[calc(100vh-4rem)] z-40 overflow-y-auto"
  [class.w-64]="!isCollapsed"
  [class.w-16]="isCollapsed"
>
  <nav class="p-4 space-y-2">
    <div *ngFor="let item of menuItems" class="sidebar-item">
      <!-- Main menu item -->
      <div
        (click)="toggleSubmenu(item)"
        class="flex items-center justify-between p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer transition-colors group"
        [class.bg-blue-50]="!item.children && isActive(item.route)"
        [class.dark:bg-blue-900]="!item.children && isActive(item.route)"
        [class.text-blue-600]="!item.children && isActive(item.route)"
        [class.dark:text-blue-400]="!item.children && isActive(item.route)"
        [class.bg-gray-50]="item.children && hasActiveChild(item)"
        [class.dark:bg-gray-700]="item.children && hasActiveChild(item)"
        [title]="isCollapsed ? item.label : ''"
      >
        <div class="flex items-center space-x-3 min-w-0 flex-1">
          <svg
            class="w-5 h-5 flex-shrink-0 transition-colors"
            [class.text-blue-600]="!item.children && isActive(item.route)"
            [class.dark:text-blue-400]="!item.children && isActive(item.route)"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              [attr.d]="item.icon"
            ></path>
          </svg>
          <span
            *ngIf="!isCollapsed"
            class="font-medium text-sm truncate transition-colors"
            >{{ item.label }}</span
          >
        </div>

        <!-- Chevron icon for items with children -->
        <div
          *ngIf="item.children && !isCollapsed"
          class="flex-shrink-0 ml-auto"
        >
          <svg
            class="w-4 h-4 transition-transform duration-200"
            [class.rotate-180]="item.isExpanded"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>

        <!-- Badge if present -->
        <span
          *ngIf="item.badge && !isCollapsed"
          class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full badge ml-auto"
          >{{ item.badge }}</span
        >
      </div>

      <!-- Submenu items -->
      <div
        *ngIf="item.children && item.isExpanded && !isCollapsed"
        class="ml-8 mt-2 space-y-1 submenu-enter"
      >
        <a
          *ngFor="let child of item.children"
          [routerLink]="child.route"
          class="flex items-center space-x-3 p-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-200 group"
          [class.active-child]="isActive(child.route)"
          [title]="child.label"
        >
          <svg
            class="w-4 h-4 flex-shrink-0 transition-colors"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              [attr.d]="child.icon"
            ></path>
          </svg>

          <span class="font-medium truncate">{{ child.label }}</span>

          <!-- Badge for child items if present -->
          <span
            *ngIf="child.badge"
            class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full badge ml-auto"
            >{{ child.badge }}</span
          >
        </a>
      </div>

      <!-- Tooltip for collapsed sidebar -->
      <div
        *ngIf="isCollapsed"
        id="sidebar-tooltip"
        class="absolute left-16 top-1/2 transform -translate-y-1/2 bg-gray-900 text-white text-xs rounded py-1 px-2 opacity-0 transition-opacity duration-200 z-50 whitespace-nowrap pointer-events-none"
      >
        {{ item.label }}
        <div *ngIf="item.children" class="mt-1 border-t border-gray-700 pt-1">
          <div *ngFor="let child of item.children" class="py-1">
            {{ child.label }}
          </div>
        </div>
      </div>
    </div>
  </nav>
</aside>
