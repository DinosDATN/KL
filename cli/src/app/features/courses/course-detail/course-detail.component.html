<!-- Course Detail Page Container -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
  
  <!-- Loading State -->
  <div *ngIf="loading" class="animate-pulse">
    <!-- Loading Banner -->
    <div class="relative bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 dark:from-gray-800 dark:via-gray-700 dark:to-gray-900 overflow-hidden">
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
          <div class="space-y-4">
            <div class="h-8 bg-white/20 rounded-lg w-3/4"></div>
            <div class="h-4 bg-white/20 rounded w-full"></div>
            <div class="h-4 bg-white/20 rounded w-2/3"></div>
          </div>
          <div class="h-64 bg-white/20 rounded-lg"></div>
        </div>
      </div>
    </div>
    
    <!-- Loading Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Panel Loading -->
        <div class="lg:col-span-2 space-y-6">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 space-y-4">
            <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-1/4"></div>
            <div class="space-y-2">
              <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
              <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-5/6"></div>
              <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-3/4"></div>
            </div>
          </div>
        </div>
        
        <!-- Right Panel Loading -->
        <div class="lg:col-span-1">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 space-y-4">
            <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-2/3"></div>
            <div class="h-12 bg-gray-300 dark:bg-gray-600 rounded"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Content When Not Loading -->
  <div *ngIf="!loading && course">
    
    <!-- Course Banner/Header -->
    <div class="relative bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 dark:from-gray-800 dark:via-gray-700 dark:to-gray-900 overflow-hidden">
      <!-- Animated Background Elements -->
      <div class="absolute inset-0 overflow-hidden">
        <!-- Floating Shapes -->
        <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-white/5 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute top-3/4 right-1/4 w-96 h-96 bg-blue-400/10 rounded-full blur-3xl animate-pulse delay-1000"></div>
        <div class="absolute top-1/2 left-3/4 w-48 h-48 bg-purple-400/10 rounded-full blur-2xl animate-pulse delay-500"></div>
      </div>
      
      <!-- Banner Content -->
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
          
          <!-- Left Column - Course Info -->
          <div class="text-white space-y-6">
            
            <!-- Breadcrumb -->
            <nav class="flex items-center space-x-2 text-sm">
              <a href="/courses" class="text-blue-200 hover:text-white transition-colors">Kh√≥a h·ªçc</a>
              <span class="text-blue-300">‚Ä∫</span>
              <span *ngIf="category" class="text-blue-200">{{ category.name }}</span>
              <span *ngIf="category" class="text-blue-300">‚Ä∫</span>
              <span class="text-white font-medium">{{ course.title }}</span>
            </nav>
            
            <!-- Course Title -->
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight">
              {{ course.title }}
            </h1>
            
            <!-- Short Description -->
            <p class="text-lg md:text-xl text-blue-100 leading-relaxed">
              {{ course.description }}
            </p>
            
            <!-- Course Meta Info -->
            <div class="flex flex-wrap items-center gap-4 text-sm">
              <!-- Instructor -->
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                  <i class="icon-user text-white"></i>
                </div>
                <span>B·ªüi <strong>{{ instructor?.name }}</strong></span>
              </div>
              
              <!-- Rating -->
              <div class="flex items-center gap-2">
                <div class="flex items-center">
                  <span *ngFor="let star of generateStarsArray(course.rating); let i = index" 
                        class="text-yellow-400"
                        [ngClass]="{
                          'text-yellow-400': i < Math.floor(course.rating),
                          'text-blue-300': i >= Math.floor(course.rating)
                        }">
                    ‚≠ê
                  </span>
                </div>
                <span>{{ course.rating.toFixed(1) }} ({{ course.students.toLocaleString() }} h·ªçc vi√™n)</span>
              </div>
              
              <!-- Level Badge -->
              <div class="px-3 py-1 rounded-full text-xs font-medium"
                   [ngClass]="{
                     'bg-green-100 text-green-800': course.level === 'Beginner',
                     'bg-yellow-100 text-yellow-800': course.level === 'Intermediate',
                     'bg-red-100 text-red-800': course.level === 'Advanced'
                   }">
                {{ course.level === 'Beginner' ? 'C∆° b·∫£n' : course.level === 'Intermediate' ? 'Trung c·∫•p' : 'N√¢ng cao' }}
              </div>
            </div>
            
          </div>
          
          <!-- Right Column - Course Thumbnail -->
          <div class="relative">
            <div class="relative overflow-hidden rounded-2xl shadow-2xl bg-white/10 backdrop-blur-sm border border-white/20">
              <img 
                [src]="course.thumbnail || 'https://placehold.co/600x400?text=Course'"
                [alt]="course.title"
                class="w-full h-64 lg:h-80 object-cover"
              />
              
              <!-- Play Button Overlay -->
              <div class="absolute inset-0 flex items-center justify-center bg-black/20 hover:bg-black/30 transition-colors cursor-pointer group">
                <div class="w-20 h-20 bg-white/90 rounded-full flex items-center justify-center group-hover:bg-white transition-colors">
                  <i class="icon-play text-blue-600 text-2xl ml-1"></i>
                </div>
              </div>
              
              <!-- Premium Badge -->
              <div *ngIf="course.is_premium" 
                   class="absolute top-4 left-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                PREMIUM
              </div>
              
              <!-- Discount Badge -->
              <div *ngIf="course.discount && course.discount > 0" 
                   class="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                -{{ course.discount }}%
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      
      <!-- Two-Column Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Panel - Main Content (2/3) -->
        <div class="lg:col-span-2 space-y-8">
          
          <!-- Course Description -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
              M√¥ t·∫£ kh√≥a h·ªçc
            </h2>
            <div class="prose dark:prose-invert max-w-none">
              <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
                {{ course.description }}
              </p>
              <!-- Additional detailed description could go here -->
              <p class="text-gray-700 dark:text-gray-300 leading-relaxed mt-4">
                Kh√≥a h·ªçc n√†y s·∫Ω gi√∫p b·∫°n n·∫Øm v·ªØng c√°c ki·∫øn th·ª©c c∆° b·∫£n v√† n√¢ng cao, 
                t·ª´ l√Ω thuy·∫øt ƒë·∫øn th·ª±c h√†nh v·ªõi c√°c v√≠ d·ª• c·ª• th·ªÉ. Ph√π h·ª£p cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu 
                c≈©ng nh∆∞ nh·ªØng ai mu·ªën n√¢ng cao k·ªπ nƒÉng c·ªßa m√¨nh.
              </p>
            </div>
          </div>
          
          <!-- Course Content/Curriculum -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
              N·ªôi dung kh√≥a h·ªçc
            </h2>

            <!-- Course Curriculum Overview -->
            <div *ngIf="courseModules.length > 0" class="space-y-4">
              <!-- Start Learning Button -->
              <div class="text-center mb-8">
                <button 
                  *ngIf="selectedLesson"
                  (click)="selectLesson(selectedLesson)"
                  class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold px-8 py-4 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                  <i class="icon-play"></i>
                  B·∫Øt ƒë·∫ßu h·ªçc
                </button>
              </div>
              
              <!-- Modules and Lessons List -->
              <div class="space-y-4">
                <div *ngFor="let module of courseModules; let moduleIndex = index" 
                     class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                  <div class="p-4 bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                      Ch∆∞∆°ng {{ moduleIndex + 1 }}: {{ module.title }}
                    </h3>
                  </div>

                  <div class="p-4">
                    <div class="space-y-3">
                      <div *ngFor="let lesson of getModuleLessons(module.id); let lessonIndex = index"
                           class="flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-600 last:border-0">
                        <div class="flex items-center gap-3">
                          <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-sm font-medium">
                            {{ lessonIndex + 1 }}
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 dark:text-white">{{ lesson.title }}</div>
                            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                              <span class="inline-flex items-center gap-1"
                                    [ngClass]="{
                                      'text-blue-600 dark:text-blue-400': lesson.type === 'video',
                                      'text-emerald-600 dark:text-emerald-400': lesson.type === 'document',
                                      'text-amber-600 dark:text-amber-400': lesson.type === 'quiz' || lesson.type === 'exercise'
                                    }">
                                <i class="icon-play" *ngIf="lesson.type === 'video'"></i>
                                <i class="icon-file" *ngIf="lesson.type === 'document'"></i>
                                <i class="icon-edit" *ngIf="lesson.type === 'quiz' || lesson.type === 'exercise'"></i>
                                {{ lesson.type === 'video' ? 'Video' : (lesson.type === 'document' ? 'T√†i li·ªáu' : 'Quiz') }}
                              </span>
                              <span>‚Ä¢</span>
                              <span>{{ lesson.duration || 'N/A' }} ph√∫t</span>
                            </div>
                          </div>
                        </div>
                        <button 
                          (click)="selectLesson(lesson)"
                          class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                          <i class="icon-play"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Default content when no modules -->
            <div *ngIf="courseModules.length === 0" class="text-center py-8">
              <div class="text-gray-400 dark:text-gray-500 text-4xl mb-4">üìö</div>
              <p class="text-gray-600 dark:text-gray-400">N·ªôi dung kh√≥a h·ªçc ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</p>
            </div>
          </div>
          
          <!-- Instructor Info -->
          <div *ngIf="instructor" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
              Gi·∫£ng vi√™n
            </h2>
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                <i class="icon-user text-blue-600 dark:text-blue-400 text-2xl"></i>
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">{{ instructor.name }}</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-3">{{ instructor.email }}</p>
                <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                  <span class="flex items-center gap-1">
                    <i class="icon-award"></i>
                    Chuy√™n gia {{ category?.name }}
                  </span>
                  <span class="flex items-center gap-1">
                    <i class="icon-users"></i>
                    {{ instructor.subscription_status === 'premium' ? 'Premium' : 'C∆° b·∫£n' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right Panel - Summary Card (1/3) -->
        <div class="lg:col-span-1">
          <div class="sticky top-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
              
              <!-- Course Thumbnail -->
              <div class="relative">
                <img 
                  [src]="course.thumbnail || 'https://placehold.co/600x400?text=Course'"
                  [alt]="course.title"
                  class="w-full h-48 object-cover"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
              </div>
              
              <!-- Price Section -->
              <div class="p-6 space-y-6">
                <div class="text-center">
                  <!-- Current Price -->
                  <div *ngIf="course.price === 0" class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">
                    Mi·ªÖn ph√≠
                  </div>
                  <div *ngIf="course.price && course.price > 0" class="space-y-1">
                    <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">
                      {{ formatPrice(course.price) }}
                    </div>
                    <!-- Original Price (if discounted) -->
                    <div *ngIf="course.discount && course.discount > 0 && course.original_price" 
                         class="text-lg text-gray-500 dark:text-gray-400 line-through">
                      {{ formatPrice(course.original_price) }}
                    </div>
                  </div>
                  
                  <!-- Discount Badge -->
                  <div *ngIf="course.discount && course.discount > 0" 
                       class="inline-block bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-sm font-medium px-3 py-1 rounded-full mt-2">
                    Gi·∫£m {{ course.discount }}%
                  </div>
                </div>
                
                <!-- Course Quick Info -->
                <div class="space-y-3 py-4 border-t border-b border-gray-200 dark:border-gray-700">
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                      <i class="icon-play"></i>
                      T·ªïng s·ªë b√†i h·ªçc
                    </span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ getTotalLessons() || course.duration || 'N/A' }}</span>
                  </div>
                  
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                      <i class="icon-clock"></i>
                      Th·ªùi l∆∞·ª£ng
                    </span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ formatDuration(getTotalDuration() || course.duration) }}</span>
                  </div>
                  
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                      <i class="icon-users"></i>
                      H·ªçc vi√™n
                    </span>
                    <span class="text-gray-900 dark:text-white font-medium">{{ course.students.toLocaleString() }}</span>
                  </div>
                  
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                      <i class="icon-award"></i>
                      C·∫•p ƒë·ªô
                    </span>
                    <span class="text-gray-900 dark:text-white font-medium">
                      {{ course.level === 'Beginner' ? 'C∆° b·∫£n' : course.level === 'Intermediate' ? 'Trung c·∫•p' : 'N√¢ng cao' }}
                    </span>
                  </div>
                  
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                      <i class="icon-star"></i>
                      ƒê√°nh gi√°
                    </span>
                    <div class="flex items-center gap-1">
                      <span class="text-yellow-500">‚≠ê</span>
                      <span class="text-gray-900 dark:text-white font-medium">{{ course.rating.toFixed(1) }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Enrollment Button -->
                <button 
                  *ngIf="!isEnrolled"
                  (click)="onEnrollClick()"
                  [disabled]="isEnrolling"
                  class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 focus:ring-4 focus:ring-blue-500/25 focus:outline-none shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                  <span *ngIf="!isEnrolling">{{ course.price === 0 ? 'H·ªçc ngay' : 'ƒêƒÉng k√Ω kh√≥a h·ªçc' }}</span>
                  <span *ngIf="isEnrolling">
                    <i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...
                  </span>
                </button>

                <!-- Already Enrolled Button -->
                <button 
                  *ngIf="isEnrolled"
                  (click)="startLearning()"
                  class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 focus:ring-4 focus:ring-green-500/25 focus:outline-none shadow-lg">
                  <i class="fas fa-check-circle"></i> B·∫°n ƒë√£ ƒëƒÉng k√Ω kh√≥a h·ªçc
                </button>
                
                <!-- Additional Info -->
                <div class="text-center">
                  <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">‚úì Truy c·∫≠p tr·ªçn ƒë·ªùi</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">‚úì Ch·ª©ng ch·ªâ ho√†n th√†nh</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      
      <!-- Related Courses Section -->
      <div *ngIf="relatedCourses.length > 0" class="mt-16">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center">
          Kh√≥a h·ªçc li√™n quan
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <app-course-card 
            *ngFor="let relatedCourse of relatedCourses"
            [course]="relatedCourse"
            [instructorName]="getInstructorName(relatedCourse.instructor_id)"
            (enrollClick)="onRelatedCourseClick(relatedCourse)"
            class="animate-fade-in cursor-pointer flex"
            (click)="onRelatedCourseClick(relatedCourse)">
          </app-course-card>
        </div>
      </div>
      
    </div>
    
  </div>
  
  <!-- Course Not Found State -->
  <div *ngIf="!loading && !course" class="text-center py-16">
    <div class="text-gray-400 dark:text-gray-500 text-6xl mb-4">‚ùå</div>
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
      Kh√¥ng t√¨m th·∫•y kh√≥a h·ªçc
    </h2>
    <p class="text-gray-600 dark:text-gray-400 mb-6">
      Kh√≥a h·ªçc b·∫°n ƒëang t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.
    </p>
    <a href="/courses" 
       class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 font-medium">
      Quay v·ªÅ danh s√°ch kh√≥a h·ªçc
    </a>
  </div>
  
</div>
