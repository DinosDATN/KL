<!-- User Management Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 sm:mb-8">
  <div class="min-w-0 flex-1">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">
      User Management
    </h1>
    <p class="mt-1 sm:mt-2 text-sm sm:text-base text-gray-600 dark:text-gray-400">
      Manage user accounts, roles, and creator applications across your platform.
    </p>
  </div>
  <div class="flex flex-wrap gap-2 sm:gap-4 flex-shrink-0">
    <button
      (click)="showCreateModal = true"
      class="inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
    >
      <svg
        class="w-4 h-4 mr-1 sm:mr-2 flex-shrink-0"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        ></path>
      </svg>
      <span class="hidden sm:inline">Tạo User Mới</span>
      <span class="sm:hidden">Tạo mới</span>
    </button>
    <button
      (click)="exportUsers()"
      class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"
    >
      <svg
        class="w-4 h-4 mr-1 sm:mr-2 flex-shrink-0"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        ></path>
      </svg>
      <span class="hidden sm:inline">Xuất Excel</span>
      <span class="sm:hidden">Export</span>
    </button>
  </div>
</div>

<!-- Tabs -->
<div class="mb-6 border-b border-gray-200 dark:border-gray-700">
  <nav class="flex space-x-8">
    <button
      (click)="onTabChange('users')"
      [class.border-b-2]="activeTab === 'users'"
      [class.border-blue-600]="activeTab === 'users'"
      [class.text-blue-600]="activeTab === 'users'"
      [class.dark:text-blue-400]="activeTab === 'users'"
      class="py-4 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"
    >
      Quản lý Users
    </button>
    <button
      (click)="onTabChange('creator-applications')"
      [class.border-b-2]="activeTab === 'creator-applications'"
      [class.border-blue-600]="activeTab === 'creator-applications'"
      [class.text-blue-600]="activeTab === 'creator-applications'"
      [class.dark:text-blue-400]="activeTab === 'creator-applications'"
      class="py-4 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"
    >
      Đơn đăng ký Creator
    </button>
  </nav>
</div>

<!-- Users Tab Content -->
<div *ngIf="activeTab === 'users'">
<!-- Filters Section -->
<div
  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-8"
  [formGroup]="filterForm"
>
  <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
    Filters
  </h3>

  <div
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-3 sm:gap-4"
  >
    <!-- Search -->
    <div class="col-span-full md:col-span-2">
      <label
        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >Search</label
      >
      <input
        type="text"
        formControlName="search"
        placeholder="Search by name or email..."
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white placeholder-gray-400"
      />
    </div>

    <!-- Role Filter -->
    <div>
      <label
        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >Role</label
      >
      <select
        formControlName="role"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
      >
        <option *ngFor="let option of roleOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Status Filter -->
    <div>
      <label
        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >Status</label
      >
      <select
        formControlName="is_active"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
      >
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Subscription Filter -->
    <div>
      <label
        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >Subscription</label
      >
      <select
        formControlName="subscription_status"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
      >
        <option
          *ngFor="let option of subscriptionOptions"
          [value]="option.value"
        >
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Sort By -->
    <div>
      <label
        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >Sort By</label
      >
      <select
        formControlName="sortBy"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
      >
        <option *ngFor="let option of sortOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <div class="mt-4 flex justify-end">
    <button
      (click)="clearFilters()"
      class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors"
    >
      Clear Filters
    </button>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="flex items-center justify-center h-64">
  <div class="flex flex-col items-center">
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
    ></div>
    <p class="mt-4 text-gray-600 dark:text-gray-400">Loading users...</p>
  </div>
</div>

<!-- Error State -->
<div
  *ngIf="error"
  class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6"
>
  <div class="flex">
    <svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
      <path
        fill-rule="evenodd"
        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
        clip-rule="evenodd"
      ></path>
    </svg>
    <div class="ml-3">
      <h3 class="text-sm font-medium text-red-800 dark:text-red-200">
        Error loading users
      </h3>
      <p class="mt-1 text-sm text-red-700 dark:text-red-300">{{ error }}</p>
    </div>
  </div>
</div>

<!-- Users Table -->
<div
  *ngIf="!isLoading && !error"
  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"
>
  <!-- Table Header with Stats -->
  <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          Users ({{ totalUsers }} total)
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400" *ngIf="pagination">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
          {{ Math.min(currentPage * itemsPerPage, totalUsers) }} of
          {{ totalUsers }} users
        </p>
      </div>

      <!-- Items per page selector -->
      <div class="flex items-center space-x-2">
        <label class="text-sm text-gray-700 dark:text-gray-300">Show:</label>
        <select
          [(ngModel)]="itemsPerPage"
          (change)="onItemsPerPageChange()"
          class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm"
        >
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span class="text-sm text-gray-700 dark:text-gray-300">per page</span>
      </div>
    </div>
  </div>

  <!-- Bulk Actions Bar -->
  <div
    *ngIf="showBulkActions"
    class="px-6 py-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800"
  >
    <div class="flex items-center justify-between">
      <span class="text-sm text-blue-700 dark:text-blue-300">
        {{ selectedUsers.length }} user(s) selected
      </span>
      <div class="flex space-x-2">
        <button
          (click)="showBulkUpdateModal = true"
          class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
        >
          Cập nhật hàng loạt
        </button>
        <button
          (click)="bulkDeleteUsers()"
          class="px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
        >
          Xóa hàng loạt
        </button>
        <button
          (click)="selectedUsers = []; showBulkActions = false"
          class="px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
        >
          Hủy chọn
        </button>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto -mx-4 sm:mx-0">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-gray-700">
        <tr>
          <th class="px-6 py-3 text-left">
            <input
              type="checkbox"
              [checked]="
                selectedUsers.length === users.length && users.length > 0
              "
              [indeterminate]="
                selectedUsers.length > 0 && selectedUsers.length < users.length
              "
              (change)="toggleAllUsers()"
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
            />
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
          >
            User
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden md:table-cell"
          >
            Role
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
          >
            Status
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden lg:table-cell"
          >
            Subscription
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden xl:table-cell"
          >
            Registered
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden xl:table-cell"
          >
            Last Seen
          </th>
          <th
            class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody
        class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
      >
        <tr
          *ngFor="let user of users; trackBy: trackByUserId"
          class="hover:bg-gray-50 dark:hover:bg-gray-700/50"
        >
          <!-- Checkbox -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
            <input
              type="checkbox"
              [checked]="isUserSelected(user.id)"
              (change)="toggleUserSelection(user.id)"
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
            />
          </td>

          <!-- User Info -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div
                  class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-medium"
                >
                  {{ user.name.charAt(0).toUpperCase() }}
                </div>
              </div>
              <div class="ml-2 sm:ml-4 min-w-0 flex-1">
                <div class="text-sm font-medium text-gray-900 dark:text-white truncate">
                  {{ user.name }}
                </div>
                <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate">
                  {{ user.email }}
                </div>
                <div class="flex items-center mt-1" *ngIf="user.is_online">
                  <div class="w-2 h-2 bg-green-500 rounded-full mr-1 sm:mr-2 flex-shrink-0"></div>
                  <span class="text-xs text-green-600 dark:text-green-400"
                    >Online</span
                  >
                </div>
                <!-- Show role on mobile -->
                <div class="mt-1 md:hidden">
                  <span
                    [class]="'inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ' + getRoleColor(user.role)"
                  >
                    {{ user.role }}
                  </span>
                </div>
              </div>
            </div>
          </td>

          <!-- Role -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell">
            <select
              [value]="user.role"
              (change)="updateUserRole(user.id, $any($event.target).value)"
              [class]="
                'px-2 py-1 text-xs font-medium rounded-full border-0 focus:ring-2 focus:ring-blue-500 ' +
                getRoleColor(user.role)
              "
            >
              <option value="user">User</option>
              <option value="creator">Creator</option>
              <option value="admin">Admin</option>
            </select>
          </td>

          <!-- Status -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
            <button
              (click)="toggleUserStatus(user.id)"
              [class]="
                'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity ' +
                getStatusColor(user.is_active)
              "
            >
              {{ user.is_active ? "Active" : "Inactive" }}
            </button>
          </td>

          <!-- Subscription -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell">
            <span
              [class]="
                'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' +
                getSubscriptionColor(user.subscription_status)
              "
            >
              {{ user.subscription_status | titlecase }}
            </span>
          </td>

          <!-- Registered -->
          <td
            class="px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 hidden xl:table-cell"
          >
            {{ formatDate(user.created_at) }}
          </td>

          <!-- Last Seen -->
          <td
            class="px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 hidden xl:table-cell"
          >
            {{ formatLastSeen(user.last_seen_at) }}
          </td>

          <!-- Actions -->
          <td
            class="px-4 sm:px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
          >
            <div class="flex space-x-2">
              <button
                (click)="viewUserDetails(user)"
                class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"
                title="Xem chi tiết"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  ></path>
                </svg>
              </button>
              <button
                (click)="confirmDeleteUser(user)"
                class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 transition-colors"
                title="Xóa user"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  ></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>

        <!-- No results -->
        <tr *ngIf="users.length === 0">
          <td colspan="8" class="px-6 py-12 text-center">
            <div class="flex flex-col items-center">
              <svg
                class="w-12 h-12 text-gray-400 dark:text-gray-600 mb-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"
                ></path>
              </svg>
              <h3
                class="text-sm font-medium text-gray-900 dark:text-white mb-1"
              >
                No users found
              </h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Try adjusting your search criteria or filters.
              </p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div
    *ngIf="pagination && pagination.total_pages > 1"
    class="px-6 py-4 border-t border-gray-200 dark:border-gray-700"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <button
          (click)="onPageChange(currentPage - 1)"
          [disabled]="currentPage === 1"
          class="px-3 py-2 text-sm text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          Previous
        </button>

        <!-- Page numbers -->
        <div class="flex space-x-1">
          <ng-container
            *ngFor="
              let page of [].constructor(pagination.total_pages);
              let i = index
            "
          >
            <button
              *ngIf="
                i + 1 <= 10 ||
                Math.abs(i + 1 - currentPage) <= 2 ||
                i + 1 > pagination.total_pages - 3
              "
              [class]="
                'px-3 py-2 text-sm rounded transition-colors ' +
                (i + 1 === currentPage
                  ? 'bg-blue-600 text-white'
                  : 'text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700')
              "
              (click)="onPageChange(i + 1)"
            >
              {{ i + 1 }}
            </button>
          </ng-container>
        </div>

        <button
          (click)="onPageChange(currentPage + 1)"
          [disabled]="currentPage === pagination.total_pages"
          class="px-3 py-2 text-sm text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Create User Modal -->
<div
  *ngIf="showCreateModal"
  class="fixed inset-0 z-50 overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
      (click)="showCreateModal = false"
    ></div>
    <div
      class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
    >
      <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <h3
          class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4"
        >
          Tạo User Mới
        </h3>
        <form [formGroup]="createUserForm" (ngSubmit)="createUser()">
          <div class="space-y-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Tên</label
              >
              <input
                type="text"
                formControlName="name"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                [class.border-red-500]="
                  createUserForm.get('name')?.invalid &&
                  createUserForm.get('name')?.touched
                "
              />
              <p
                *ngIf="
                  createUserForm.get('name')?.invalid &&
                  createUserForm.get('name')?.touched
                "
                class="mt-1 text-sm text-red-600 dark:text-red-400"
              >
                Tên là bắt buộc (tối thiểu 2 ký tự)
              </p>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Email</label
              >
              <input
                type="email"
                formControlName="email"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                [class.border-red-500]="
                  createUserForm.get('email')?.invalid &&
                  createUserForm.get('email')?.touched
                "
              />
              <p
                *ngIf="
                  createUserForm.get('email')?.invalid &&
                  createUserForm.get('email')?.touched
                "
                class="mt-1 text-sm text-red-600 dark:text-red-400"
              >
                Email không hợp lệ
              </p>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Mật khẩu</label
              >
              <input
                type="password"
                formControlName="password"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                [class.border-red-500]="
                  createUserForm.get('password')?.invalid &&
                  createUserForm.get('password')?.touched
                "
              />
              <p
                *ngIf="
                  createUserForm.get('password')?.invalid &&
                  createUserForm.get('password')?.touched
                "
                class="mt-1 text-sm text-red-600 dark:text-red-400"
              >
                Mật khẩu tối thiểu 6 ký tự
              </p>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Vai trò</label
              >
              <select
                formControlName="role"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              >
                <option value="user">User</option>
                <option value="creator">Creator</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Trạng thái</label
              >
              <select
                formControlName="subscription_status"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              >
                <option value="free">Free</option>
                <option value="premium">Premium</option>
              </select>
            </div>
            <div class="flex items-center">
              <input
                type="checkbox"
                formControlName="is_active"
                id="is_active"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
              />
              <label
                for="is_active"
                class="ml-2 block text-sm text-gray-700 dark:text-gray-300"
                >Kích hoạt ngay</label
              >
            </div>
          </div>
          <div class="mt-6 flex justify-end space-x-3">
            <button
              type="button"
              (click)="showCreateModal = false"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
            >
              Hủy
            </button>
            <button
              type="submit"
              [disabled]="createUserForm.invalid"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Tạo User
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete User Modal -->
<div
  *ngIf="showDeleteModal && selectedUserForDelete"
  class="fixed inset-0 z-50 overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
      (click)="
        showDeleteModal = false;
        selectedUserForDelete = null;
        deletionInfo = null
      "
    ></div>
    <div
      class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
    >
      <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div
            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20 sm:mx-0 sm:h-10 sm:w-10"
          >
            <svg
              class="h-6 w-6 text-red-600 dark:text-red-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              ></path>
            </svg>
          </div>
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1">
            <h3
              class="text-lg leading-6 font-medium text-gray-900 dark:text-white"
            >
              Xác nhận xóa user
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Bạn có chắc chắn muốn xóa user
                <strong class="text-gray-900 dark:text-white">{{
                  selectedUserForDelete.name
                }}</strong>
                ({{ selectedUserForDelete.email }})? Hành động này không thể
                hoàn tác.
              </p>
            </div>

            <!-- Loading deletion info -->
            <div *ngIf="isLoadingDeletionInfo" class="mt-4">
              <div class="flex items-center space-x-2">
                <div
                  class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"
                ></div>
                <span class="text-sm text-gray-500 dark:text-gray-400"
                  >Đang kiểm tra dữ liệu liên quan...</span
                >
              </div>
            </div>

            <!-- Deletion info -->
            <div *ngIf="deletionInfo && !isLoadingDeletionInfo" class="mt-4">
              <div
                class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4"
                *ngIf="deletionInfo.hasRelatedData"
              >
                <div class="flex">
                  <svg
                    class="h-5 w-5 text-yellow-400 mr-2"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <div class="flex-1">
                    <h4
                      class="text-sm font-medium text-yellow-800 dark:text-yellow-200 mb-2"
                    >
                      Dữ liệu liên quan sẽ bị xóa:
                    </h4>
                    <ul
                      class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1"
                    >
                      <li
                        *ngIf="deletionInfo.relatedData.courses > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.courses
                        }}</span>
                        <span>khóa học đã tạo</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.problems > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.problems
                        }}</span>
                        <span>bài tập đã tạo</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.enrollments > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.enrollments
                        }}</span>
                        <span>đăng ký khóa học</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.submissions > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.submissions
                        }}</span>
                        <span>bài nộp</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.contestSubmissions > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.contestSubmissions
                        }}</span>
                        <span>bài nộp contest</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.reviews > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.reviews
                        }}</span>
                        <span>đánh giá</span>
                      </li>
                      <li
                        *ngIf="deletionInfo.relatedData.comments > 0"
                        class="flex items-center"
                      >
                        <span class="font-medium mr-2">{{
                          deletionInfo.relatedData.comments
                        }}</span>
                        <span>bình luận</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div
                class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"
                *ngIf="!deletionInfo.hasRelatedData"
              >
                <div class="flex">
                  <svg
                    class="h-5 w-5 text-green-400 mr-2"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <p class="text-sm text-green-700 dark:text-green-300">
                    User này không có dữ liệu liên quan. Có thể xóa an toàn.
                  </p>
                </div>
              </div>

              <div
                class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-4"
                *ngIf="
                  (!deletionInfo.canDelete &&
                    deletionInfo.relatedData.courses > 0) ||
                  deletionInfo.relatedData.problems > 0
                "
              >
                <p class="text-sm text-red-700 dark:text-red-300">
                  <strong>Lưu ý:</strong> User này đã tạo nội dung. Xóa user sẽ
                  xóa tất cả dữ liệu liên quan. Nếu muốn giữ lại nội dung, hãy
                  cân nhắc vô hiệu hóa user thay vì xóa.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div
          class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:space-x-reverse sm:space-x-3"
        >
          <button
            (click)="deleteUser(selectedUserForDelete.id, false)"
            [disabled]="isDeleting || isLoadingDeletionInfo"
            class="w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span *ngIf="!isDeleting">
              {{
                deletionInfo && !deletionInfo.canDelete ? "Xóa bắt buộc" : "Xóa"
              }}
            </span>
            <span *ngIf="isDeleting" class="flex items-center">
              <svg
                class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              Đang xóa...
            </span>
          </button>
          <button
            (click)="
              showDeleteModal = false;
              selectedUserForDelete = null;
              deletionInfo = null
            "
            [disabled]="isDeleting"
            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div
  *ngIf="showDetailsModal && selectedUserForDetails"
  class="fixed inset-0 z-50 overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
      (click)="showDetailsModal = false; selectedUserForDetails = null"
    ></div>
    <div
      class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
    >
      <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="flex items-center justify-between mb-4">
          <h3
            class="text-lg leading-6 font-medium text-gray-900 dark:text-white"
          >
            Chi tiết User
          </h3>
          <button
            (click)="showDetailsModal = false; selectedUserForDetails = null"
            class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Tên</label
              >
              <p class="mt-1 text-sm text-gray-900 dark:text-white">
                {{ selectedUserForDetails.name }}
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Email</label
              >
              <p class="mt-1 text-sm text-gray-900 dark:text-white">
                {{ selectedUserForDetails.email }}
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Vai trò</label
              >
              <p class="mt-1">
                <span
                  [class]="
                    'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' +
                    getRoleColor(selectedUserForDetails.role)
                  "
                  >{{ selectedUserForDetails.role }}</span
                >
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Trạng thái</label
              >
              <p class="mt-1">
                <span
                  [class]="
                    'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' +
                    getStatusColor(selectedUserForDetails.is_active)
                  "
                  >{{
                    selectedUserForDetails.is_active ? "Active" : "Inactive"
                  }}</span
                >
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Subscription</label
              >
              <p class="mt-1">
                <span
                  [class]="
                    'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' +
                    getSubscriptionColor(
                      selectedUserForDetails.subscription_status
                    )
                  "
                  >{{ selectedUserForDetails.subscription_status }}</span
                >
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Online</label
              >
              <p class="mt-1">
                <span
                  *ngIf="selectedUserForDetails.is_online"
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400"
                  >Online</span
                >
                <span
                  *ngIf="!selectedUserForDetails.is_online"
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"
                  >Offline</span
                >
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Ngày đăng ký</label
              >
              <p class="mt-1 text-sm text-gray-900 dark:text-white">
                {{ formatDate(selectedUserForDetails.created_at) }}
              </p>
            </div>
            <div>
              <label
                class="text-sm font-medium text-gray-500 dark:text-gray-400"
                >Lần cuối hoạt động</label
              >
              <p class="mt-1 text-sm text-gray-900 dark:text-white">
                {{ formatLastSeen(selectedUserForDetails.last_seen_at) }}
              </p>
            </div>
          </div>
        </div>
        <div class="mt-6 flex justify-end">
          <button
            (click)="showDetailsModal = false; selectedUserForDetails = null"
            class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
          >
            Đóng
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bulk Update Modal -->
<div
  *ngIf="showBulkUpdateModal"
  class="fixed inset-0 z-50 overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
      (click)="showBulkUpdateModal = false"
    ></div>
    <div
      class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
    >
      <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <h3
          class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4"
        >
          Cập nhật hàng loạt ({{ selectedUsers.length }} users)
        </h3>
        <form [formGroup]="bulkUpdateForm" (ngSubmit)="bulkUpdateUsers()">
          <div class="space-y-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Vai trò (để trống nếu không đổi)</label
              >
              <select
                formControlName="role"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              >
                <option value="">Không thay đổi</option>
                <option value="user">User</option>
                <option value="creator">Creator</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Trạng thái (để trống nếu không đổi)</label
              >
              <select
                formControlName="is_active"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              >
                <option value="">Không thay đổi</option>
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Subscription (để trống nếu không đổi)</label
              >
              <select
                formControlName="subscription_status"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              >
                <option value="">Không thay đổi</option>
                <option value="free">Free</option>
                <option value="premium">Premium</option>
              </select>
            </div>
          </div>
          <div class="mt-6 flex justify-end space-x-3">
            <button
              type="button"
              (click)="showBulkUpdateModal = false"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
            >
              Hủy
            </button>
            <button
              type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors"
            >
              Cập nhật
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Creator Applications Tab Content -->
<div *ngIf="activeTab === 'creator-applications'">
  <!-- Filters -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Trạng thái
        </label>
        <select
          [(ngModel)]="applicationsStatusFilter"
          (change)="onApplicationsStatusFilterChange()"
          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
        >
          <option value="">Tất cả</option>
          <option value="pending">Chờ duyệt</option>
          <option value="approved">Đã duyệt</option>
          <option value="rejected">Đã từ chối</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Tìm kiếm
        </label>
        <input
          type="text"
          [(ngModel)]="applicationsSearchTerm"
          (keyup.enter)="onApplicationsSearch()"
          placeholder="Tìm theo tên, email, chuyên ngành..."
          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
        />
      </div>
      <div class="flex items-end">
        <button
          (click)="onApplicationsSearch()"
          class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          Tìm kiếm
        </button>
      </div>
    </div>
  </div>

  <!-- Applications List -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow overflow-hidden">
    <div *ngIf="isLoadingApplications" class="p-8 text-center">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-2 text-gray-600 dark:text-gray-400">Đang tải...</p>
    </div>

    <div *ngIf="!isLoadingApplications && applicationsError" class="p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg m-4">
      <p class="text-red-800 dark:text-red-200">{{ applicationsError }}</p>
    </div>

    <div *ngIf="!isLoadingApplications && !applicationsError && creatorApplications.length === 0" class="p-8 text-center">
      <p class="text-gray-600 dark:text-gray-400">Không có đơn đăng ký nào</p>
    </div>

    <div *ngIf="!isLoadingApplications && !applicationsError && creatorApplications.length > 0" class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
              Người dùng
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
              Chuyên ngành
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
              Trạng thái
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
              Ngày đăng ký
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
              Thao tác
            </th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
          <tr *ngFor="let app of creatorApplications" class="hover:bg-gray-50 dark:hover:bg-gray-700">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <img
                  *ngIf="app.User?.avatar_url"
                  [src]="app.User?.avatar_url"
                  [alt]="app.User?.name"
                  class="h-10 w-10 rounded-full mr-3"
                />
                <div>
                  <div class="text-sm font-medium text-gray-900 dark:text-white">
                    {{ app.User?.name }}
                  </div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    {{ app.User?.email }}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900 dark:text-white">{{ app.specialization }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="getApplicationStatusClass(app.status)"
              >
                {{ getApplicationStatusText(app.status) }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {{ app.created_at | date: 'dd/MM/yyyy HH:mm' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button
                (click)="viewApplication(app)"
                class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3"
              >
                Xem chi tiết
              </button>
              <button
                *ngIf="app.status === 'pending'"
                (click)="approveApplication(app)"
                class="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-3"
              >
                Duyệt
              </button>
              <button
                *ngIf="app.status === 'pending'"
                (click)="openRejectApplicationModal(app)"
                class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"
              >
                Từ chối
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="applicationsPagination && applicationsPagination.total_pages > 1" class="px-6 py-4 border-t border-gray-200 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <div class="text-sm text-gray-700 dark:text-gray-300">
          Trang {{ applicationsPagination.current_page }} / {{ applicationsPagination.total_pages }}
          ({{ applicationsPagination.total_items }} đơn)
        </div>
        <div class="flex gap-2">
          <button
            *ngFor="let page of [].constructor(applicationsPagination.total_pages); let i = index"
            (click)="onApplicationsPageChange(i + 1)"
            [class.bg-blue-600]="i + 1 === applicationsPagination.current_page"
            [class.text-white]="i + 1 === applicationsPagination.current_page"
            class="px-3 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"
          >
            {{ i + 1 }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Application Detail Modal -->
  <div
    *ngIf="showApplicationDetailModal && selectedApplication"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    (click)="closeApplicationDetailModal()"
  >
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
      (click)="$event.stopPropagation()"
    >
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white">
            Chi tiết đơn đăng ký
          </h2>
          <button
            (click)="closeApplicationDetailModal()"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
          >
            ✕
          </button>
        </div>
      </div>

      <div class="p-6 space-y-6">
        <!-- User Info -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 border border-blue-100 dark:border-gray-600 shadow-sm">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
              <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            Thông tin người dùng
          </h3>
          <div class="flex flex-col md:flex-row gap-6">
            <!-- Avatar -->
            <div class="flex-shrink-0">
              <img
                *ngIf="selectedApplication.User?.avatar_url"
                [src]="selectedApplication.User?.avatar_url"
                [alt]="selectedApplication.User?.name"
                class="h-24 w-24 rounded-full object-cover border-4 border-white dark:border-gray-700 shadow-lg"
                onerror="this.src='https://ui-avatars.com/api/?name=' + encodeURIComponent(this.alt) + '&size=150&background=random'"
              />
              <div *ngIf="!selectedApplication.User?.avatar_url" class="h-24 w-24 rounded-full bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                {{ selectedApplication.User?.name?.charAt(0)?.toUpperCase() || 'U' }}
              </div>
            </div>
            
            <!-- Basic Info -->
            <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="space-y-4">
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Tên</p>
                  <p class="text-base font-semibold text-gray-900 dark:text-white">{{ selectedApplication.User?.name || '—' }}</p>
                </div>
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Email</p>
                  <p class="text-base text-gray-900 dark:text-white break-all">{{ selectedApplication.User?.email || '—' }}</p>
                </div>
                <div *ngIf="selectedApplication.User?.role">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Vai trò</p>
                  <span class="inline-block px-2.5 py-1 text-xs font-semibold rounded-full"
                        [ngClass]="{
                          'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300': selectedApplication.User?.role === 'admin',
                          'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300': selectedApplication.User?.role === 'creator',
                          'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300': selectedApplication.User?.role === 'user'
                        }">
                    {{ selectedApplication.User?.role === 'admin' ? 'Quản trị viên' : selectedApplication.User?.role === 'creator' ? 'Người sáng tạo' : 'Người dùng' }}
                  </span>
                </div>
              </div>
              
              <!-- Profile Details -->
              <div class="space-y-4" *ngIf="selectedApplication.User?.Profile">
                <div *ngIf="selectedApplication.User?.Profile?.phone">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Điện thoại</p>
                  <p class="text-base text-gray-900 dark:text-white">{{ selectedApplication.User?.Profile?.phone }}</p>
                </div>
                <div *ngIf="selectedApplication.User?.Profile?.address">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Địa chỉ</p>
                  <p class="text-base text-gray-900 dark:text-white">{{ selectedApplication.User?.Profile?.address }}</p>
                </div>
                <div *ngIf="selectedApplication.User?.Profile?.birthday">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Ngày sinh</p>
                  <p class="text-base text-gray-900 dark:text-white">
                    {{ selectedApplication.User?.Profile?.birthday | date: 'dd/MM/yyyy' }}
                    <span *ngIf="calculateAge(selectedApplication.User?.Profile?.birthday)" class="text-sm text-gray-500 dark:text-gray-400 ml-2">
                      ({{ calculateAge(selectedApplication.User?.Profile?.birthday) }} tuổi)
                    </span>
                  </p>
                </div>
                <div *ngIf="selectedApplication.User?.Profile?.gender">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1.5">Giới tính</p>
                  <p class="text-base text-gray-900 dark:text-white">
                    {{ selectedApplication.User?.Profile?.gender === 'male' ? 'Nam' : selectedApplication.User?.Profile?.gender === 'female' ? 'Nữ' : 'Khác' }}
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bio -->
          <div *ngIf="selectedApplication.User?.Profile?.bio" class="mt-4 pt-4 border-t border-blue-200 dark:border-gray-600">
            <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Giới thiệu</p>
            <p class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap">{{ selectedApplication.User?.Profile?.bio }}</p>
          </div>
          
          <!-- Social Links -->
          <div *ngIf="selectedApplication.User?.Profile?.website_url || selectedApplication.User?.Profile?.github_url || selectedApplication.User?.Profile?.linkedin_url" 
               class="mt-4 pt-4 border-t border-blue-200 dark:border-gray-600">
            <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Liên kết</p>
            <div class="flex flex-wrap gap-3">
              <a *ngIf="selectedApplication.User?.Profile?.website_url" 
                 [href]="selectedApplication.User?.Profile?.website_url" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="inline-flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors text-sm border border-gray-200 dark:border-gray-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path>
                  <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path>
                </svg>
                Website
              </a>
              <a *ngIf="selectedApplication.User?.Profile?.github_url" 
                 [href]="selectedApplication.User?.Profile?.github_url" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="inline-flex items-center gap-2 px-3 py-1.5 bg-gray-900 dark:bg-gray-800 text-white rounded-lg hover:bg-gray-800 dark:hover:bg-gray-700 transition-colors text-sm">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482C17.138 18.18 20 14.425 20 10.017 20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path>
                </svg>
                GitHub
              </a>
              <a *ngIf="selectedApplication.User?.Profile?.linkedin_url" 
                 [href]="selectedApplication.User?.Profile?.linkedin_url" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="inline-flex items-center gap-2 px-3 py-1.5 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors text-sm">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.338 16.338H13.67V12.16c0-.995-.017-2.277-1.387-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248H8.014v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.778 3.203 4.092v4.711zM5.005 6.575a1.548 1.548 0 11-.003-3.096 1.548 1.548 0 01.003 3.096zm-1.337 9.763H6.34v-8.59H3.667v8.59zM17.668 1H2.328C1.595 1 1 1.581 1 2.298v15.403C1 18.418 1.595 19 2.328 19h15.34c.734 0 1.332-.582 1.332-1.299V2.298C19 1.581 18.402 1 17.668 1z" clip-rule="evenodd"></path>
                </svg>
                LinkedIn
              </a>
            </div>
          </div>
        </div>

        <!-- Application Details -->
        <div class="space-y-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <div class="p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg">
              <svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            Thông tin đơn đăng ký
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Specialization -->
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 border border-indigo-100 dark:border-gray-600">
              <p class="text-xs font-semibold text-indigo-600 dark:text-indigo-400 uppercase tracking-wide mb-2 flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"></path>
                </svg>
                Chuyên ngành
              </p>
              <p class="text-base font-semibold text-gray-900 dark:text-white">{{ selectedApplication.specialization || '—' }}</p>
            </div>
            
            <!-- Status -->
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 border border-indigo-100 dark:border-gray-600">
              <p class="text-xs font-semibold text-indigo-600 dark:text-indigo-400 uppercase tracking-wide mb-2 flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Trạng thái
              </p>
              <span
                class="inline-block px-3 py-1.5 text-sm font-semibold rounded-lg"
                [ngClass]="getApplicationStatusClass(selectedApplication.status)"
              >
                {{ getApplicationStatusText(selectedApplication.status) }}
              </span>
            </div>
          </div>

          <!-- Skills -->
          <div class="bg-gradient-to-br from-amber-50 to-orange-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-amber-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-amber-700 dark:text-amber-400 uppercase tracking-wide mb-3 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
              Kỹ năng
            </p>
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let skill of getSkillsArray(selectedApplication.skills)"
                class="inline-flex items-center px-3 py-1.5 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 rounded-lg text-sm font-medium border border-amber-200 dark:border-amber-800 shadow-sm"
              >
                <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                {{ skill }}
              </span>
              <span *ngIf="getSkillsArray(selectedApplication.skills).length === 0" class="text-gray-500 dark:text-gray-400 text-sm italic">— Không có thông tin —</span>
            </div>
          </div>

          <!-- Work Experience -->
          <div class="bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-emerald-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-emerald-700 dark:text-emerald-400 uppercase tracking-wide mb-4 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v3.57A22.952 22.952 0 0110 13a22.95 22.95 0 01-8-1.43V8a2 2 0 012-2h2zm2-1a1 1 0 011-1h2a1 1 0 011 1v1H8V5zm1 5a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                <path d="M2 13.692V16a2 2 0 002 2h12a2 2 0 002-2v-2.308A24.974 24.974 0 0110 15c-2.796 0-5.487-.46-8-1.308z"></path>
              </svg>
              Kinh nghiệm làm việc
            </p>
            <div class="space-y-3">
              <div
                *ngFor="let exp of getWorkExperienceArray(selectedApplication.work_experience); let i = index"
                class="p-4 bg-white dark:bg-gray-800 rounded-lg border border-emerald-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow"
              >
                <div class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center shadow-md">
                    <span class="text-white font-bold text-lg">{{ i + 1 }}</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="font-bold text-gray-900 dark:text-white text-base mb-1">{{ exp.position || '—' }}</p>
                    <p class="text-sm font-medium text-emerald-600 dark:text-emerald-400 mb-2">{{ exp.company || '—' }}</p>
                    <div class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-emerald-50 dark:bg-emerald-900/20 rounded-md">
                      <svg class="w-4 h-4 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                      </svg>
                      <span class="text-xs font-semibold text-emerald-700 dark:text-emerald-300">{{ exp.years || 0 }} năm kinh nghiệm</span>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngIf="getWorkExperienceArray(selectedApplication.work_experience).length === 0" class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm italic bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-600">
                — Không có thông tin —
              </div>
            </div>
          </div>

          <!-- Bio -->
          <div class="bg-gradient-to-br from-violet-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-violet-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-violet-700 dark:text-violet-400 uppercase tracking-wide mb-3 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              Mô tả bản thân
            </p>
            <p class="text-gray-800 dark:text-gray-200 leading-relaxed whitespace-pre-wrap bg-white dark:bg-gray-800 p-4 rounded-lg border border-violet-100 dark:border-gray-600">{{ selectedApplication.bio || '—' }}</p>
          </div>
          
          <!-- Teaching Experience -->
          <div *ngIf="selectedApplication.teaching_experience" class="bg-gradient-to-br from-rose-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-rose-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-rose-700 dark:text-rose-400 uppercase tracking-wide mb-3 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"></path>
              </svg>
              Kinh nghiệm giảng dạy
            </p>
            <p class="text-gray-800 dark:text-gray-200 leading-relaxed whitespace-pre-wrap bg-white dark:bg-gray-800 p-4 rounded-lg border border-rose-100 dark:border-gray-600">{{ selectedApplication.teaching_experience }}</p>
          </div>

          <!-- Certificates -->
          <div *ngIf="getCertificatesArray(selectedApplication.certificates).length > 0" class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-green-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-green-700 dark:text-green-400 uppercase tracking-wide mb-4 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Chứng chỉ / Bằng cấp
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div
                *ngFor="let cert of getCertificatesArray(selectedApplication.certificates)"
                class="p-4 bg-white dark:bg-gray-800 rounded-lg border border-green-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow"
              >
                <div class="flex items-start gap-3">
                  <div class="flex-shrink-0 p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                    <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="font-bold text-gray-900 dark:text-white mb-2">{{ cert.type || '—' }}</p>
                    <a *ngIf="cert.url" [href]="cert.url" target="_blank" rel="noopener noreferrer" 
                       class="text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 hover:underline truncate block mb-1 flex items-center gap-1">
                      <svg class="w-3.5 h-3.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path>
                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path>
                      </svg>
                      <span class="truncate">{{ cert.url }}</span>
                    </a>
                    <a *ngIf="cert.file_url" [href]="cert.file_url" target="_blank" rel="noopener noreferrer"
                       class="text-xs text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:underline truncate block flex items-center gap-1">
                      <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                      </svg>
                      File đính kèm
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Portfolio -->
          <div *ngIf="getPortfolioArray(selectedApplication.portfolio).length > 0" class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-5 border border-purple-100 dark:border-gray-600">
            <p class="text-xs font-semibold text-purple-700 dark:text-purple-400 uppercase tracking-wide mb-4 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"></path>
              </svg>
              Portfolio / Dự án
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div
                *ngFor="let item of getPortfolioArray(selectedApplication.portfolio)"
                class="p-4 bg-white dark:bg-gray-800 rounded-lg border border-purple-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow"
              >
                <div class="flex items-start gap-3">
                  <div class="flex-shrink-0 p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                    <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"></path>
                    </svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="font-bold text-gray-900 dark:text-white mb-2 capitalize">{{ getPortfolioTypeLabel(item.type) }}</p>
                    <a [href]="item.url" target="_blank" rel="noopener noreferrer" 
                       class="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 hover:underline truncate block flex items-center gap-1">
                      <svg class="w-3.5 h-3.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path>
                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path>
                      </svg>
                      <span class="truncate">{{ item.url }}</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div *ngIf="selectedApplication.status === 'pending'" class="flex gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <button
            (click)="approveApplication(selectedApplication)"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
          >
            Duyệt đơn
          </button>
          <button
            (click)="openRejectApplicationModal(selectedApplication)"
            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
          >
            Từ chối
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div
    *ngIf="showRejectApplicationModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    (click)="closeRejectApplicationModal()"
  >
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full"
      (click)="$event.stopPropagation()"
    >
      <div class="p-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
          Từ chối đơn đăng ký
        </h2>
        <form [formGroup]="rejectionForm" (ngSubmit)="rejectApplication()">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Lý do từ chối <span class="text-red-500">*</span>
            </label>
            <textarea
              formControlName="rejection_reason"
              rows="4"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
              placeholder="Nhập lý do từ chối đơn đăng ký..."
            ></textarea>
            <p
              *ngIf="rejectionForm.get('rejection_reason')?.invalid && rejectionForm.get('rejection_reason')?.touched"
              class="mt-1 text-sm text-red-600 dark:text-red-400"
            >
              Vui lòng nhập lý do từ chối (tối thiểu 10 ký tự)
            </p>
          </div>
          <div class="flex gap-4">
            <button
              type="submit"
              [disabled]="rejectionForm.invalid || isLoadingApplications"
              class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50"
            >
              Xác nhận từ chối
            </button>
            <button
              type="button"
              (click)="closeRejectApplicationModal()"
              class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700"
            >
              Hủy
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
