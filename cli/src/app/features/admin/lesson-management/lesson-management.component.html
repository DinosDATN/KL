<!-- Admin Lesson Management Page -->
<div
  class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"
>
  <!-- Header -->
  <div
    class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 transition-colors duration-200"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div
        class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
      >
        <!-- Title -->
        <div>
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Lesson Management
          </h1>
          <p class="text-gray-600 dark:text-gray-400">
            Manage course lessons, content, and materials
          </p>
        </div>

        <!-- Top Actions -->
        <div class="flex flex-wrap items-center gap-3">
          <!-- Create Lesson Button -->
          <button
            (click)="openCreateModal()"
            class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200"
          >
            <i class="icon-plus mr-2"></i>
            Create Lesson
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Total Lessons -->
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
              Total Lessons
            </p>
            <p
              *ngIf="!loadingStats"
              class="text-3xl font-bold text-gray-900 dark:text-white mt-2"
            >
              {{ stats?.totalLessons || 0 }}
            </p>
            <div
              *ngIf="loadingStats"
              class="h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mt-2"
            ></div>
          </div>
          <div
            class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center"
          >
            <i class="icon-book text-blue-600 dark:text-blue-400 text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Document Lessons -->
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
              Document Lessons
            </p>
            <p
              *ngIf="!loadingStats"
              class="text-3xl font-bold text-gray-900 dark:text-white mt-2"
            >
              {{ stats?.documentLessons || 0 }}
            </p>
            <div
              *ngIf="loadingStats"
              class="h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mt-2"
            ></div>
          </div>
          <div
            class="w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center"
          >
            <i class="icon-file-text text-green-600 dark:text-green-400 text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Video Lessons -->
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
              Video Lessons
            </p>
            <p
              *ngIf="!loadingStats"
              class="text-3xl font-bold text-gray-900 dark:text-white mt-2"
            >
              {{ stats?.videoLessons || 0 }}
            </p>
            <div
              *ngIf="loadingStats"
              class="h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mt-2"
            ></div>
          </div>
          <div
            class="w-12 h-12 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center"
          >
            <i class="icon-video text-purple-600 dark:text-purple-400 text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Average Duration -->
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
              Avg Duration
            </p>
            <p
              *ngIf="!loadingStats"
              class="text-3xl font-bold text-gray-900 dark:text-white mt-2"
            >
              {{ stats?.averageDuration || 0 }}m
            </p>
            <div
              *ngIf="loadingStats"
              class="h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mt-2"
            ></div>
          </div>
          <div
            class="w-12 h-12 bg-orange-100 dark:bg-orange-900/20 rounded-lg flex items-center justify-center"
          >
            <i class="icon-clock text-orange-600 dark:text-orange-400 text-xl"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
    <!-- Search and Filters -->
    <div class="mb-6 space-y-4">
      <!-- Search Bar -->
      <div class="relative">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <i class="icon-search text-gray-400 text-lg"></i>
        </div>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
          (input)="onSearch()"
          placeholder="Search lessons by title or content..."
          class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
        />
        <button
          *ngIf="searchTerm"
          (click)="searchTerm = ''; onSearch()"
          class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200"
        >
          <i class="icon-x text-lg"></i>
        </button>
      </div>

      <!-- Filters Row -->
      <div class="flex flex-wrap gap-4">
        <!-- Course Filter -->
        <div class="flex-1 min-w-[200px]">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
          >
            Course
          </label>
          <select
            [(ngModel)]="selectedCourseId"
            (change)="onCourseFilterChange()"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
          >
            <option [value]="null">All Courses</option>
            <option *ngFor="let course of courses" [value]="course.id">
              {{ course.title }}
            </option>
          </select>
        </div>

        <!-- Module Filter -->
        <div class="flex-1 min-w-[200px]">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
          >
            Module
          </label>
          <select
            [(ngModel)]="selectedModuleId"
            (change)="onModuleFilterChange()"
            [disabled]="!selectedCourseId"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
          >
            <option [value]="null">All Modules</option>
            <option *ngFor="let module of modules" [value]="module.id">
              {{ module.title }}
            </option>
          </select>
        </div>

        <!-- Type Filter -->
        <div class="flex-1 min-w-[150px]">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
          >
            Type
          </label>
          <select
            [(ngModel)]="selectedType"
            (change)="onTypeFilterChange()"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
          >
            <option [value]="null">All Types</option>
            <option value="document">Document</option>
            <option value="video">Video</option>
            <option value="exercise">Exercise</option>
            <option value="quiz">Quiz</option>
          </select>
        </div>

        <!-- Sort By -->
        <div class="flex-1 min-w-[150px]">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
          >
            Sort By
          </label>
          <select
            [(ngModel)]="sortBy"
            (change)="onSortChange()"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
          >
            <option value="created_at_desc">Newest First</option>
            <option value="created_at_asc">Oldest First</option>
            <option value="title_asc">Title A-Z</option>
            <option value="title_desc">Title Z-A</option>
            <option value="position_asc">Position ↑</option>
            <option value="position_desc">Position ↓</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Bulk Actions Bar -->
    <div
      *ngIf="selectedLessons.length > 0"
      class="mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between"
    >
      <div class="flex items-center gap-4">
        <span class="text-sm font-medium text-blue-900 dark:text-blue-100">
          {{ selectedLessons.length }} lesson(s) selected
        </span>
        <button
          (click)="onBulkDelete()"
          class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors duration-200"
        >
          <i class="icon-trash mr-2"></i>
          Delete Selected
        </button>
      </div>
      <button
        (click)="selectedLessons = []"
        class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors duration-200"
      >
        Clear Selection
      </button>
    </div>

    <!-- Lessons Table -->
    <div
      class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden transition-colors duration-200"
    >
      <!-- Loading State -->
      <div *ngIf="loading" class="p-8 text-center">
        <i class="icon-loader animate-spin text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600 dark:text-gray-400">Loading lessons...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="p-8 text-center">
        <i class="icon-alert-circle text-4xl text-red-400 mb-4"></i>
        <p class="text-red-600 dark:text-red-400">{{ error }}</p>
        <button
          (click)="loadLessons()"
          class="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200"
        >
          Retry
        </button>
      </div>

      <!-- Lessons List -->
      <div *ngIf="!loading && !error">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead
              class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200"
            >
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  <input
                    type="checkbox"
                    [checked]="isAllSelected()"
                    (change)="onSelectAll($event)"
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                  />
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Title
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Course / Module
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Type
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Duration
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Position
                </th>
                <th
                  class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700 transition-colors duration-200"
            >
              <tr
                *ngFor="let lesson of lessons"
                class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200"
              >
                <td class="px-6 py-4 whitespace-nowrap">
                  <input
                    type="checkbox"
                    [checked]="isLessonSelected(lesson.id)"
                    (change)="onLessonToggle(lesson.id)"
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                  />
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm font-medium text-gray-900 dark:text-white">
                    {{ lesson.title }}
                  </div>
                  <div
                    *ngIf="lesson.content"
                    class="text-xs text-gray-500 dark:text-gray-400 mt-1 truncate max-w-xs"
                  >
                    {{ lesson.content.substring(0, 50) }}...
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-white">
                    {{ lesson.Module?.Course?.title || 'N/A' }}
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    {{ lesson.Module?.title || 'N/A' }}
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    [ngClass]="{
                      'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400':
                        lesson.type === 'document',
                      'bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400':
                        lesson.type === 'video',
                      'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400':
                        lesson.type === 'exercise',
                      'bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400':
                        lesson.type === 'quiz'
                    }"
                    class="px-2 py-1 text-xs font-medium rounded-full capitalize"
                  >
                    {{ lesson.type }}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                  {{ lesson.duration ? lesson.duration + 'm' : 'N/A' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                  {{ lesson.position }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex items-center justify-end gap-2">
                    <button
                      (click)="openEditModal(lesson)"
                      class="text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200"
                      title="Edit"
                    >
                      <i class="icon-edit"></i>
                    </button>
                    <button
                      (click)="onDeleteLesson(lesson.id)"
                      class="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 transition-colors duration-200"
                      title="Delete"
                    >
                      <i class="icon-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div
          *ngIf="lessons.length === 0"
          class="p-8 text-center text-gray-500 dark:text-gray-400"
        >
          <i class="icon-book text-4xl mb-4"></i>
          <p>No lessons found</p>
        </div>

        <!-- Pagination -->
        <div
          *ngIf="totalPages > 1"
          class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between"
        >
          <div class="text-sm text-gray-700 dark:text-gray-300">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
            {{ Math.min(currentPage * itemsPerPage, totalItems) }} of
            {{ totalItems }} lessons
          </div>
          <div class="flex gap-2">
            <button
              (click)="onPageChange(currentPage - 1)"
              [disabled]="currentPage === 1"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
            >
              Previous
            </button>
            <button
              *ngFor="let page of getPageNumbers()"
              (click)="onPageChange(page)"
              [ngClass]="{
                'bg-blue-600 text-white': page === currentPage,
                'text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600':
                  page !== currentPage
              }"
              class="px-4 py-2 text-sm font-medium border border-gray-300 dark:border-gray-600 rounded-lg transition-colors duration-200"
            >
              {{ page }}
            </button>
            <button
              (click)="onPageChange(currentPage + 1)"
              [disabled]="currentPage === totalPages"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lesson Form Modal -->
  <app-lesson-form
    *ngIf="isFormModalOpen"
    [lesson]="editingLesson"
    [isEdit]="!!editingLesson"
    (lessonCreated)="onLessonCreated($event)"
    (lessonUpdated)="onLessonUpdated($event)"
    (close)="closeFormModal()"
  ></app-lesson-form>
</div>

