<div class="creator-payments-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Qu·∫£n l√Ω Thanh to√°n</h1>
      <p class="subtitle">X√°c nh·∫≠n thanh to√°n t·ª´ h·ªçc vi√™n</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i danh s√°ch...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="icon">‚ö†Ô∏è</i>
    {{ errorMessage }}
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading" class="content">
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon total">üìä</div>
        <div class="stat-content">
          <div class="stat-value">{{ payments.length }}</div>
          <div class="stat-label">T·ªïng thanh to√°n</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon pending">‚è≥</div>
        <div class="stat-content">
          <div class="stat-value">{{ getTotalPending() }}</div>
          <div class="stat-label">Ch·ªù x√°c nh·∫≠n</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon completed">‚úÖ</div>
        <div class="stat-content">
          <div class="stat-value">{{ getTotalCompleted() }}</div>
          <div class="stat-label">ƒê√£ x√°c nh·∫≠n</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon revenue">üí∞</div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(getTotalAmount()) }}</div>
          <div class="stat-label">T·ªïng doanh thu</div>
        </div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="filters-section">
      <div class="filter-group">
        <label for="filterStatus">Tr·∫°ng th√°i:</label>
        <select 
          id="filterStatus" 
          [(ngModel)]="filterStatus" 
          (change)="onFilterChange()"
          class="filter-select">
          <option value="all">T·∫•t c·∫£</option>
          <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
          <option value="completed">ƒê√£ x√°c nh·∫≠n</option>
        </select>
      </div>

      <div class="search-group">
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="onSearchChange()"
          placeholder="T√¨m ki·∫øm theo t√™n, email, kh√≥a h·ªçc..."
          class="search-input">
        <span class="search-icon">üîç</span>
      </div>
    </div>

    <!-- Payments Table -->
    <div class="table-container">
      <table class="payments-table" *ngIf="filteredPayments.length > 0">
        <thead>
          <tr>
            <th>H·ªçc vi√™n</th>
            <th>Kh√≥a h·ªçc</th>
            <th>S·ªë ti·ªÅn</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ng√†y t·∫°o</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of getPaginatedPayments()">
            <td>
              <div class="user-info">
                <div class="user-name">{{ payment.User?.name }}</div>
                <div class="user-email">{{ payment.User?.email }}</div>
              </div>
            </td>
            <td>
              <div class="course-title">{{ payment.Course?.title }}</div>
            </td>
            <td>
              <div class="amount">{{ formatCurrency(payment.amount) }}</div>
            </td>
            <td>
              <span class="status-badge" [ngClass]="getStatusBadgeClass(payment.payment_status)">
                {{ getStatusText(payment.payment_status) }}
              </span>
            </td>
            <td>
              <div class="date">{{ formatDate(payment.created_at) }}</div>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  *ngIf="payment.payment_status === 'pending'"
                  (click)="openConfirmModal(payment)"
                  [disabled]="isProcessing"
                  class="btn btn-success btn-sm"
                  title="X√°c nh·∫≠n thanh to√°n">
                  ‚úì X√°c nh·∫≠n
                </button>
                <span *ngIf="payment.payment_status === 'completed'" class="completed-text">
                  ƒê√£ x√°c nh·∫≠n
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredPayments.length === 0" class="empty-state">
        <div class="empty-icon">üí≥</div>
        <h3>Kh√¥ng c√≥ thanh to√°n n√†o</h3>
        <p>Ch∆∞a c√≥ thanh to√°n n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc c·ªßa b·∫°n.</p>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="filteredPayments.length > itemsPerPage">
      <button 
        (click)="previousPage()" 
        [disabled]="currentPage === 1"
        class="pagination-btn">
        ‚Üê Tr∆∞·ªõc
      </button>
      
      <div class="pagination-pages">
        <button 
          *ngFor="let page of getPageNumbers()"
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          class="pagination-page">
          {{ page }}
        </button>
      </div>
      
      <button 
        (click)="nextPage()" 
        [disabled]="currentPage === totalPages"
        class="pagination-btn">
        Sau ‚Üí
      </button>
    </div>

    <!-- Info -->
    <div class="info-text">
      Hi·ªÉn th·ªã {{ getDisplayRange() }} 
      trong t·ªïng s·ªë {{ filteredPayments.length }} thanh to√°n
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>X√°c nh·∫≠n thanh to√°n</h2>
      <button class="close-btn" (click)="closeConfirmModal()">√ó</button>
    </div>
    
    <div class="modal-body" *ngIf="selectedPayment">
      <div class="payment-info">
        <div class="info-row">
          <span class="info-label">H·ªçc vi√™n:</span>
          <span class="info-value">{{ selectedPayment.User?.name }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Kh√≥a h·ªçc:</span>
          <span class="info-value">{{ selectedPayment.Course?.title }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">S·ªë ti·ªÅn:</span>
          <span class="info-value">{{ formatCurrency(selectedPayment.amount) }}</span>
        </div>
      </div>

      <div class="form-group">
        <label for="transactionId">M√£ giao d·ªãch (t√πy ch·ªçn)</label>
        <input 
          type="text" 
          id="transactionId"
          [(ngModel)]="transactionId"
          class="form-control"
          placeholder="Nh·∫≠p m√£ giao d·ªãch n·∫øu c√≥">
      </div>

      <div class="form-group">
        <label for="confirmNotes">Ghi ch√∫ (t√πy ch·ªçn)</label>
        <textarea 
          id="confirmNotes"
          [(ngModel)]="confirmNotes"
          class="form-control"
          rows="3"
          placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c·∫ßn"></textarea>
      </div>

      <div class="warning-box">
        <i class="icon">‚ö†Ô∏è</i>
        <p>Sau khi x√°c nh·∫≠n, h·ªçc vi√™n s·∫Ω c√≥ th·ªÉ truy c·∫≠p kh√≥a h·ªçc ngay l·∫≠p t·ª©c.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="closeConfirmModal()"
        [disabled]="isProcessing">
        H·ªßy
      </button>
      <button 
        class="btn btn-primary" 
        (click)="confirmPayment()"
        [disabled]="isProcessing">
        <span *ngIf="!isProcessing">X√°c nh·∫≠n</span>
        <span *ngIf="isProcessing">ƒêang x·ª≠ l√Ω...</span>
      </button>
    </div>
  </div>
</div>
