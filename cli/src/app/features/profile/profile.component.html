<div
  class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200"
>
  <!-- Header Hero -->
  <section
    class="bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-700 dark:to-purple-800 text-white"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-14">
      <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
        <img
          [src]="user.avatar_url || 'https://i.pravatar.cc/150?img=12'"
          alt="{{ user.name }}"
          class="w-24 h-24 md:w-28 md:h-28 rounded-full ring-4 ring-white/30 shadow-lg object-cover"
        />
        <div class="flex-1">
          <div class="flex items-center gap-3 flex-wrap">
            <h1 class="text-2xl md:text-3xl font-bold">{{ user.name }}</h1>
            <span
              *ngIf="user.subscription_status === 'premium'"
              class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-400 text-gray-900"
              >Premium</span
            >
            <span
              class="flex items-center text-sm"
              [ngClass]="user.is_online ? 'text-green-200' : 'text-gray-200'"
            >
              <span
                class="w-2 h-2 rounded-full mr-1"
                [ngClass]="user.is_online ? 'bg-green-300' : 'bg-gray-300'"
              ></span>
              {{ user.is_online ? "Online" : "Offline" }}
            </span>
          </div>
          <p class="mt-2 text-blue-100 dark:text-blue-200">
            {{ userProfile.bio }}
          </p>
          <div class="mt-3 flex flex-wrap gap-3 text-sm text-blue-100/90">
            <a
              *ngIf="userProfile.github_url"
              [href]="userProfile.github_url"
              target="_blank"
              class="hover:underline"
              >GitHub</a
            >
            <a
              *ngIf="userProfile.linkedin_url"
              [href]="userProfile.linkedin_url"
              target="_blank"
              class="hover:underline"
              >LinkedIn</a
            >
            <a
              *ngIf="userProfile.website_url"
              [href]="userProfile.website_url"
              target="_blank"
              class="hover:underline"
              >Website</a
            >
          </div>
        </div>
        <div class="grid grid-cols-3 gap-4 text-center w-full md:w-auto">
          <div class="bg-white/10 rounded-lg p-3">
            <div class="text-xl font-bold">{{ userStat.level }}</div>
            <div class="text-xs opacity-80">Level</div>
          </div>
          <div class="bg-white/10 rounded-lg p-3">
            <div class="text-xl font-bold">{{ formatNumber(userStat.xp) }}</div>
            <div class="text-xs opacity-80">XP</div>
          </div>
          <div class="bg-white/10 rounded-lg p-3">
            <div class="text-xl font-bold">#{{ userStat.rank }}</div>
            <div class="text-xs opacity-80">Rank</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <div class="bg-white dark:bg-gray-800 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex gap-6 overflow-x-auto no-scrollbar" aria-label="Tabs">
        <button
          (click)="setActiveTab('overview')"
          [ngClass]="
            activeTab === 'overview'
              ? 'border-blue-600 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white'
          "
          class="py-4 border-b-2 font-medium"
        >
          Tổng quan
        </button>
        <button
          (click)="setActiveTab('activity')"
          [ngClass]="
            activeTab === 'activity'
              ? 'border-blue-600 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white'
          "
          class="py-4 border-b-2 font-medium"
        >
          Hoạt động
        </button>
        <button
          (click)="setActiveTab('achievements')"
          [ngClass]="
            activeTab === 'achievements'
              ? 'border-blue-600 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white'
          "
          class="py-4 border-b-2 font-medium"
        >
          Thành tựu
        </button>
        <button
          (click)="setActiveTab('courses')"
          [ngClass]="
            activeTab === 'courses'
              ? 'border-blue-600 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white'
          "
          class="py-4 border-b-2 font-medium"
        >
          Khóa học
        </button>
        <button
          (click)="setActiveTab('settings')"
          [ngClass]="
            activeTab === 'settings'
              ? 'border-blue-600 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white'
          "
          class="py-4 border-b-2 font-medium"
        >
          Cài đặt
        </button>
      </nav>
    </div>
  </div>

  <!-- Content -->
  <section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="space-y-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div
            class="p-4 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20"
          >
            <div class="text-sm text-gray-600 dark:text-gray-300">
              Khóa học đã hoàn thành
            </div>
            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
              {{ userStat.courses_completed }}
            </div>
          </div>
          <div
            class="p-4 rounded-xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20"
          >
            <div class="text-sm text-gray-600 dark:text-gray-300">Giờ học</div>
            <div class="text-2xl font-bold text-green-600 dark:text-green-400">
              {{ userStat.hours_learned }}
            </div>
          </div>
          <div
            class="p-4 rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20"
          >
            <div class="text-sm text-gray-600 dark:text-gray-300">
              Bài đã giải
            </div>
            <div
              class="text-2xl font-bold text-purple-600 dark:text-purple-400"
            >
              {{ userStat.problems_solved }}
            </div>
          </div>
          <div
            class="p-4 rounded-xl bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20"
          >
            <div class="text-sm text-gray-600 dark:text-gray-300">
              Chuỗi ngày
            </div>
            <div
              class="text-2xl font-bold text-yellow-600 dark:text-yellow-400"
            >
              {{ userStat.current_streak }} ngày
            </div>
          </div>
        </div>

        <!-- Goals & Progress -->
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
            <h3 class="text-lg font-semibold mb-4">Mục tiêu</h3>
            <div class="space-y-4">
              <div *ngFor="let goal of userGoals" class="">
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-gray-700 dark:text-gray-300">{{
                    goal.title
                  }}</span>
                  <span class="text-gray-500 dark:text-gray-400"
                    >{{ goal.current }}/{{ goal.target }} {{ goal.unit }}</span
                  >
                </div>
                <div
                  class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                >
                  <div
                    class="h-2 bg-gradient-to-r from-blue-500 to-purple-600"
                    [style.width.%]="
                      getProgressPercentage(goal.current, goal.target)
                    "
                  ></div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
            <h3 class="text-lg font-semibold mb-4">Lần nộp gần đây</h3>
            <div class="space-y-4">
              <div
                *ngFor="let item of getRecentSubmissions()"
                class="flex items-center justify-between"
              >
                <div class="flex-1 min-w-0">
                  <div class="font-medium truncate">
                    {{ item.problem.title }}
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    {{ formatDateTime(item.submission.submitted_at) }}
                  </div>
                </div>
                <span
                  class="px-2 py-1 text-xs rounded-full"
                  [ngClass]="getStatusColor(item.submission.status)"
                >
                  {{ item.submission.status }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Courses in progress -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Khóa học đang học</h3>
            <a
              routerLink="/courses"
              class="text-blue-600 dark:text-blue-400 hover:underline text-sm"
              >Xem tất cả →</a
            >
          </div>
          <div class="grid md:grid-cols-2 gap-6">
            <div
              *ngFor="let item of getUserCourses()"
              class="border dark:border-gray-700 rounded-lg p-4"
            >
              <div class="flex items-center justify-between mb-2">
                <div class="font-semibold">{{ item.course.title }}</div>
                <span
                  class="text-xs px-2 py-1 rounded-full"
                  [ngClass]="
                    item.course.is_premium
                      ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400'
                      : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'
                  "
                  >{{ item.course.is_premium ? "Premium" : "Miễn phí" }}</span
                >
              </div>
              <div
                class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
              >
                <div
                  class="h-2 bg-gradient-to-r from-green-500 to-blue-600"
                  [style.width.%]="item.enrollment.progress"
                ></div>
              </div>
              <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">
                Tiến độ: {{ item.enrollment.progress }}%
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Tab -->
      <div *ngIf="activeTab === 'activity'" class="space-y-4">
        <div
          *ngFor="let log of userActivityLogs"
          class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 flex items-start gap-4"
        >
          <div class="text-2xl">{{ getActivityIcon(log.type) }}</div>
          <div class="flex-1">
            <div class="font-medium">{{ log.title }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">
              {{ formatDateTime(log.date) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements Tab -->
      <div
        *ngIf="activeTab === 'achievements'"
        class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        <div
          *ngFor="let item of getUserAchievements()"
          class="bg-white dark:bg-gray-800 rounded-xl shadow p-6"
        >
          <div class="flex items-center gap-4">
            <div class="text-3xl">🏅</div>
            <div class="flex-1">
              <div class="font-semibold">{{ item.achievement.title }}</div>
              <div class="text-sm text-gray-600 dark:text-gray-300">
                {{ item.achievement.description }}
              </div>
              <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                Nhận: {{ formatDate(item.dateEarned) }}
              </div>
            </div>
            <span
              class="px-2 py-1 text-xs rounded-full"
              [ngClass]="getRarityColor(item.achievement.rarity)"
              >{{ item.achievement.rarity }}</span
            >
          </div>
        </div>
      </div>

      <!-- Courses Tab -->
      <div *ngIf="activeTab === 'courses'" class="grid md:grid-cols-2 gap-6">
        <div
          *ngFor="let item of getUserCourses()"
          class="bg-white dark:bg-gray-800 rounded-xl shadow overflow-hidden"
        >
          <div class="h-28 bg-gradient-to-r from-blue-500 to-purple-600"></div>
          <div class="p-6">
            <div class="flex items-center justify-between mb-2">
              <div class="font-semibold text-lg">{{ item.course.title }}</div>
              <span
                class="text-xs px-2 py-1 rounded-full"
                [ngClass]="
                  item.course.is_premium
                    ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400'
                    : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'
                "
                >{{ item.course.is_premium ? "Premium" : "Miễn phí" }}</span
              >
            </div>
            <div
              class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
            >
              <div
                class="h-2 bg-gradient-to-r from-green-500 to-blue-600"
                [style.width.%]="item.enrollment.progress"
              ></div>
            </div>
            <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">
              Tiến độ: {{ item.enrollment.progress }}% — Trạng thái:
              {{ item.enrollment.status }}
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div
        *ngIf="activeTab === 'settings'"
        class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 space-y-6"
      >
        <h3 class="text-lg font-semibold">Tùy chỉnh giao diện</h3>
        <div class="flex flex-wrap gap-4 items-center">
          <button
            (click)="themeService.toggleTheme()"
            class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"
          >
            Chuyển {{ themeService.isDarkMode() ? "Light" : "Dark" }} mode
          </button>
          <div class="text-sm text-gray-600 dark:text-gray-300">
            Chế độ hiện tại:
            <span class="font-semibold">{{
              themeService.isDarkMode() ? "Dark" : "Light"
            }}</span>
          </div>
        </div>
        <div class="grid sm:grid-cols-2 gap-4 text-sm">
          <div class="space-y-1">
            <div class="text-gray-500 dark:text-gray-400">Email</div>
            <div class="font-medium">{{ user.email }}</div>
          </div>
          <div class="space-y-1">
            <div class="text-gray-500 dark:text-gray-400">Điện thoại</div>
            <div class="font-medium">{{ userProfile.phone || "—" }}</div>
          </div>
          <div class="space-y-1">
            <div class="text-gray-500 dark:text-gray-400">Địa chỉ</div>
            <div class="font-medium">{{ userProfile.address || "—" }}</div>
          </div>
          <div class="space-y-1">
            <div class="text-gray-500 dark:text-gray-400">Ngôn ngữ</div>
            <div class="font-medium">
              {{ userProfile.preferred_language.toUpperCase() }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
