<!-- Modern Forum/Chat Platform -->
<div
  class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300"
>
  <!-- Navigation Tabs -->
  <div
    class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex space-x-8">
        <button
          class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
          [class]="
            currentView === 'forum'
              ? 'border-blue-500 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'
          "
          (click)="currentView = 'forum'; viewMode = 'list'"
        >
          üè† Di·ªÖn ƒë√†n
        </button>
        <button
          class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
          [class]="
            currentView === 'chat'
              ? 'border-blue-500 text-blue-600 dark:text-blue-400'
              : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'
          "
          (click)="currentView = 'chat'"
        >
          üí¨ Chat tr·ª±c ti·∫øp
        </button>
      </nav>
    </div>
  </div>

  <!-- Forum View -->
  <div *ngIf="currentView === 'forum' && viewMode === 'list'">
    <app-forum-layout
      (categoryClicked)="navigateToCategory($event)"
      (postClicked)="viewPost($event)"
      (createPost)="openPostCreator()"
    ></app-forum-layout>

    <!-- Floating Action Button for Mobile -->
    <button
      (click)="openPostCreator()"
      class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-40 md:hidden"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 6v6m0 0v6m0-6h6m-6 0H6"
        />
      </svg>
    </button>
  </div>

  <!-- Post Detail View -->
  <div *ngIf="currentView === 'forum' && viewMode === 'post' && selectedPostId">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Back Button -->
      <div class="mb-6">
        <button
          (click)="backToForum()"
          class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
          Quay l·∫°i di·ªÖn ƒë√†n
        </button>
      </div>

      <app-post-detail [postId]="selectedPostId"></app-post-detail>
    </div>
  </div>

  <!-- Chat View -->
  <div
    *ngIf="currentView === 'chat'"
    class="flex-1 bg-gray-50 dark:bg-gray-900 flex overflow-hidden"
    style="height: calc(100vh - 73px);"
  >
    <!-- Mobile Sidebar Toggle Button -->
    <button
      *ngIf="isMobileView"
      (click)="toggleSidebar()"
      class="fixed top-20 left-4 z-50 p-3 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 backdrop-blur-sm"
      [class.sidebar-open]="showSidebar"
    >
      <svg
        class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-300"
        [class.rotate-90]="showSidebar"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"
        ></path>
      </svg>
    </button>

    <!-- Mobile Overlay -->
    <div
      *ngIf="isMobileView && showSidebar"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 transition-opacity duration-300"
      (click)="showSidebar = false"
    ></div>

    <!-- Chat Sidebar -->
    <aside
      class="forum-sidebar bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 ease-in-out z-40"
      [class.sidebar-visible]="showSidebar"
    >
      <app-chat-sidebar
        [rooms]="getFilteredRooms()"
        [selectedRoom]="selectedRoom"
        [currentUser]="currentUser"
        [onlineUsers]="onlineUsers"
        [searchTerm]="searchTerm"
        [activeFilter]="activeFilter"
        (roomSelected)="onSelectRoom($event)"
        (searchChanged)="searchTerm = $event"
        (filterChanged)="activeFilter = $event"
        (createGroup)="onCreateGroup()"
        [getUser]="getUser.bind(this)"
        [getRoomMembers]="getRoomMembers.bind(this)"
      ></app-chat-sidebar>
    </aside>

    <!-- Main Chat Area -->
    <main
      class="forum-main flex flex-col bg-white dark:bg-gray-800 min-w-0 flex-1 relative"
    >
      <!-- Welcome State -->
      <div
        *ngIf="!selectedRoom"
        class="flex-1 flex items-center justify-center p-8 bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800"
      >
        <div class="text-center max-w-lg space-y-6">
          <div class="relative">
            <div
              class="absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-600 rounded-full blur-xl opacity-20 animate-pulse"
            ></div>
            <div
              class="relative bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-xl"
            >
              <svg
                class="w-16 h-16 mx-auto text-blue-500 dark:text-blue-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                ></path>
              </svg>
            </div>
          </div>

          <div class="space-y-3">
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white">
              Ch√†o m·ª´ng ƒë·∫øn v·ªõi Chat
            </h2>
            <p class="text-lg text-gray-600 dark:text-gray-400 leading-relaxed">
              Tr√≤ chuy·ªán tr·ª±c ti·∫øp v·ªõi c·ªông ƒë·ªìng
            </p>
          </div>

          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <button
              *ngIf="!isMobileView && !showSidebar"
              (click)="toggleSidebar()"
              class="inline-flex items-center gap-2 px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-xl transition-all duration-200 hover:scale-105 shadow-lg"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                ></path>
              </svg>
              Xem cu·ªôc tr√≤ chuy·ªán
            </button>

            <button
              (click)="onCreateGroup()"
              class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-medium rounded-xl transition-all duration-200 hover:scale-105 shadow-lg"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                ></path>
              </svg>
              T·∫°o nh√≥m m·ªõi
            </button>
          </div>
        </div>
      </div>

      <!-- Chat Main Component -->
      <app-chat-main
        *ngIf="selectedRoom"
        class="flex-1 min-h-0"
        [room]="selectedRoom"
        [messages]="getRoomMessages(selectedRoom.id)"
        [currentUser]="currentUser"
        [roomMembers]="getRoomMembers(selectedRoom.id)"
        [reactions]="reactions"
        [typingUsers]="typingUsers"
        [isRoomAdmin]="isRoomAdmin(selectedRoom.id, currentUser.id)"
        (sendMessage)="onSendMessage($event)"
        (reactToMessage)="
          onReactToMessage($event.messageId, $event.reactionType)
        "
        [getUser]="getUser.bind(this)"
        [getMessageReactions]="getMessageReactions.bind(this)"
      ></app-chat-main>
    </main>
  </div>
</div>

<!-- Post Creator Modal -->
<app-post-creator
  [isOpen]="showPostCreator"
  (closeModal)="closePostCreator()"
  (postCreated)="onPostCreated($event)"
></app-post-creator>

<!-- Create Group Modal -->
<app-create-group-modal
  *ngIf="showCreateGroupModal"
  [users]="users"
  [currentUser]="currentUser"
  (groupCreated)="onGroupCreated($event)"
  (modalClosed)="onCloseModal()"
></app-create-group-modal>
