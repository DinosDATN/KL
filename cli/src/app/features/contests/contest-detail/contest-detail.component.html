<!-- Contest Detail Page -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
  
  <!-- Loading State -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-screen">
    <div class="text-center">
      <div class="animate-spin inline-block w-8 h-8 border-4 border-current border-t-transparent text-blue-600 rounded-full mb-4"></div>
      <p class="text-gray-600 dark:text-gray-400">Đang tải thông tin cuộc thi...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="flex items-center justify-center min-h-screen">
    <div class="text-center bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 max-w-md mx-auto">
      <div class="text-red-500 mb-4">
        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
      </div>
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Lỗi</h3>
      <p class="text-gray-600 dark:text-gray-400 mb-4">{{ error }}</p>
      <button (click)="goBack()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
        Quay lại danh sách cuộc thi
      </button>
    </div>
  </div>

  <!-- Contest Content -->
  <div *ngIf="contest && !loading && !error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Back Button -->
    <button (click)="goBack()" class="mb-6 inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Quay lại danh sách cuộc thi
    </button>

    <!-- Contest Header -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden mb-8">
      <div class="p-8">
        <!-- Status and Registration -->
        <div class="flex items-center justify-between mb-6">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                [ngClass]="contestService.getContestStatusColor(contest.status)">
            <span *ngIf="contest.status === 'active'" class="w-2 h-2 bg-green-400 rounded-full animate-pulse mr-2"></span>
            <span *ngIf="contest.status === 'upcoming'" class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
            <span *ngIf="contest.status === 'completed'" class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
            {{ contest.status === 'active' ? 'Đang diễn ra' : 
               contest.status === 'upcoming' ? 'Sắp tới' : 
               contest.status === 'completed' ? 'Đã kết thúc' : contest.status }}
          </span>

          <!-- Registration Button -->
          <div *ngIf="authService.isAuthenticated() && (contest.status === 'upcoming' || contest.status === 'active')">
            <button (click)="onRegisterToggle()"
                    class="px-6 py-2 rounded-lg font-medium transition-colors duration-200"
                    [ngClass]="{
                      'bg-green-600 hover:bg-green-700 text-white': !contest.is_registered,
                      'bg-red-600 hover:bg-red-700 text-white': contest.is_registered
                    }">
              {{ contest.is_registered ? 'Hủy tham gia' : 'Tham gia cuộc thi' }}
            </button>
          </div>
        </div>

        <!-- Contest Title -->
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
          {{ contest.title }}
        </h1>

        <!-- Contest Description -->
        <p *ngIf="contest.description" class="text-lg text-gray-600 dark:text-gray-400 mb-6">
          {{ contest.description }}
        </p>

        <!-- Contest Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-6">
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">
              {{ contest.problem_count || contestProblems.length || 0 }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Bài tập</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">
              {{ contest.participant_count || 0 }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Người tham gia</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">
              {{ contestService.formatDuration(contest.duration) }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Thời gian</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold"
                 [ngClass]="{
                   'text-green-600 dark:text-green-400': contest.status === 'active',
                   'text-blue-600 dark:text-blue-400': contest.status === 'upcoming',
                   'text-gray-500 dark:text-gray-400': contest.status === 'completed'
                 }">
              {{ contest.status === 'completed' ? 'Đã kết thúc' : contestService.formatTimeRemaining(contest.time_remaining) }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">
              {{ contest.status === 'active' ? 'Còn lại' : 
                 contest.status === 'upcoming' ? 'Bắt đầu trong' : 'Trạng thái' }}
            </div>
          </div>
        </div>

        <!-- Creator Info -->
        <div *ngIf="contest.Creator" class="flex items-center text-gray-600 dark:text-gray-400">
          <span class="mr-2">Tạo bởi:</span>
          <img [src]="contest.Creator.avatar_url || 'https://ui-avatars.com/api/?name=' + (contest.Creator.name | slice:0:2) + '&background=3b82f6&color=ffffff'"
               [alt]="contest.Creator.name" 
               class="w-6 h-6 rounded-full mr-2">
          <span class="font-medium">{{ contest.Creator.name }}</span>
        </div>
      </div>
    </div>

    <!-- Contest Problems -->
    <div *ngIf="contestProblems.length > 0" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Bài tập cuộc thi</h2>
        <p class="text-gray-600 dark:text-gray-400 mt-2">{{ contestProblems.length }} bài tập trong cuộc thi này</p>
      </div>
      <div class="divide-y divide-gray-200 dark:divide-gray-700">
        <div *ngFor="let contestProblem of contestProblems; let i = index" 
             class="p-6 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-4 mb-2">
                <span class="text-lg font-bold text-gray-500 dark:text-gray-400">
                  #{{ i + 1 }}
                </span>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                  {{ contestProblem.Problem?.title || 'Problem ' + (i + 1) }}
                </h3>
                <span *ngIf="contestProblem.Problem?.difficulty" 
                      class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                      [ngClass]="contestService.getDifficultyColor(contestProblem.Problem?.difficulty)">
                  {{ contestProblem.Problem?.difficulty }}
                </span>
              </div>
              <p *ngIf="contestProblem.Problem?.estimated_time" 
                 class="text-sm text-gray-500 dark:text-gray-400">
                Thời gian ước tính: {{ contestProblem.Problem?.estimated_time }}
              </p>
            </div>
            <div class="text-right flex flex-col items-end gap-3">
              <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                {{ contestProblem.score }} điểm
              </div>
              
              <!-- Start Problem Button - Only show if user is registered and contest is active -->
              <button 
                *ngIf="canStartProblem()"
                (click)="onStartProblem(contestProblem)"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Làm bài tập
              </button>
              
              <!-- View Problem Button - Show for everyone -->
              <button 
                *ngIf="!canStartProblem()"
                (click)="onViewProblem(contestProblem)"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
                Xem chi tiết
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Problems Message -->
    <div *ngIf="contestProblems.length === 0" 
         class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 text-center">
      <div class="text-gray-400 mb-4">
        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
        Chưa có bài tập
      </h3>
      <p class="text-gray-600 dark:text-gray-400">
        Cuộc thi này chưa có bài tập nào. Hãy quay lại sau!
      </p>
    </div>

  </div>
</div>
